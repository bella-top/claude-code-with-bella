<svg viewBox="0 0 1000 800" xmlns="http://www.w3.org/2000/svg">
  <!-- 定义渐变和样式 -->
  <defs>
    <linearGradient id="userGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#4F46E5;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#6366F1;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="coreGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#059669;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#10B981;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="toolGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#DC2626;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#EF4444;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="outputGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#7C3AED;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#8B5CF6;stop-opacity:1" />
    </linearGradient>
  </defs>
  
  <!-- 背景 -->
  <rect width="1000" height="800" fill="#F8FAFC"/>
  
  <!-- 标题 -->
  <text x="500" y="30" text-anchor="middle" font-family="Arial, sans-serif" font-size="24" font-weight="bold" fill="#1E293B">
    Claude Code 执行原理图
  </text>
  
  <!-- 用户层 -->
  <rect x="50" y="70" width="900" height="80" rx="10" fill="url(#userGradient)" opacity="0.1"/>
  <text x="70" y="95" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#4F46E5">
    用户层 (User Layer)
  </text>
  <text x="70" y="115" font-family="Arial, sans-serif" font-size="14" fill="#64748B">
    用户输入: "为TransferUtils写一个测试用例"
  </text>
  <text x="70" y="135" font-family="Arial, sans-serif" font-size="14" fill="#64748B">
    CLI命令、自然语言需求、代码文件路径
  </text>
  
  <!-- 箭头1 -->
  <path d="M 500 150 L 500 180" stroke="#64748B" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- 核心处理层 -->
  <rect x="50" y="200" width="900" height="150" rx="10" fill="url(#coreGradient)" opacity="0.1"/>
  <text x="70" y="225" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#059669">
    核心处理层 (Core Processing Layer)
  </text>
  
  <!-- 核心处理子模块 -->
  <rect x="80" y="240" width="180" height="100" rx="8" fill="white" stroke="#10B981" stroke-width="2"/>
  <text x="90" y="260" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#059669">
    需求理解 &amp; 计划制定
  </text>
  <text x="90" y="280" font-family="Arial, sans-serif" font-size="10" fill="#64748B">
    • 分析用户需求</text>
  <text x="90" y="295" font-family="Arial, sans-serif" font-size="10" fill="#64748B">
    • 理解代码结构</text>
  <text x="90" y="310" font-family="Arial, sans-serif" font-size="10" fill="#64748B">
    • 制定执行计划</text>
  <text x="90" y="325" font-family="Arial, sans-serif" font-size="10" fill="#64748B">
    • TodoWrite管理任务</text>
  
  <rect x="280" y="240" width="180" height="100" rx="8" fill="white" stroke="#10B981" stroke-width="2"/>
  <text x="290" y="260" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#059669">
    任务执行引擎
  </text>
  <text x="290" y="280" font-family="Arial, sans-serif" font-size="10" fill="#64748B">
    • 顺序执行计划</text>
  <text x="290" y="295" font-family="Arial, sans-serif" font-size="10" fill="#64748B">
    • 工具调用协调</text>
  <text x="290" y="310" font-family="Arial, sans-serif" font-size="10" fill="#64748B">
    • 状态管理</text>
  <text x="290" y="325" font-family="Arial, sans-serif" font-size="10" fill="#64748B">
    • 错误处理</text>
  
  <rect x="480" y="240" width="180" height="100" rx="8" fill="white" stroke="#10B981" stroke-width="2"/>
  <text x="490" y="260" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#059669">
    上下文管理
  </text>
  <text x="490" y="280" font-family="Arial, sans-serif" font-size="10" fill="#64748B">
    • 代码库理解</text>
  <text x="490" y="295" font-family="Arial, sans-serif" font-size="10" fill="#64748B">
    • 文件关联分析</text>
  <text x="490" y="310" font-family="Arial, sans-serif" font-size="10" fill="#64748B">
    • 历史记录追踪</text>
  <text x="490" y="325" font-family="Arial, sans-serif" font-size="10" fill="#64748B">
    • CLAUDE.md指导</text>
  
  <rect x="680" y="240" width="180" height="100" rx="8" fill="white" stroke="#10B981" stroke-width="2"/>
  <text x="690" y="260" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#059669">
    质量保证
  </text>
  <text x="690" y="280" font-family="Arial, sans-serif" font-size="10" fill="#64748B">
    • 代码规范检查</text>
  <text x="690" y="295" font-family="Arial, sans-serif" font-size="10" fill="#64748B">
    • 测试执行</text>
  <text x="690" y="310" font-family="Arial, sans-serif" font-size="10" fill="#64748B">
    • 构建验证</text>
  <text x="690" y="325" font-family="Arial, sans-serif" font-size="10" fill="#64748B">
    • 最佳实践遵循</text>
  
  <!-- 箭头2 -->
  <path d="M 500 350 L 500 380" stroke="#64748B" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- 工具层 -->
  <rect x="50" y="400" width="900" height="200" rx="10" fill="url(#toolGradient)" opacity="0.1"/>
  <text x="70" y="425" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#DC2626">
    工具生态层 (Tool Ecosystem Layer)
  </text>
  
  <!-- 工具分类 -->
  <rect x="80" y="440" width="200" height="150" rx="8" fill="white" stroke="#EF4444" stroke-width="2"/>
  <text x="90" y="460" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#DC2626">
    文件操作工具
  </text>
  <text x="90" y="480" font-family="Arial, sans-serif" font-size="10" fill="#64748B">
    • Read - 文件读取</text>
  <text x="90" y="495" font-family="Arial, sans-serif" font-size="10" fill="#64748B">
    • Write - 文件写入</text>
  <text x="90" y="510" font-family="Arial, sans-serif" font-size="10" fill="#64748B">
    • Edit - 文件编辑</text>
  <text x="90" y="525" font-family="Arial, sans-serif" font-size="10" fill="#64748B">
    • MultiEdit - 批量编辑</text>
  <text x="90" y="540" font-family="Arial, sans-serif" font-size="10" fill="#64748B">
    • LS - 目录列表</text>
  <text x="90" y="555" font-family="Arial, sans-serif" font-size="10" fill="#64748B">
    • Notebook - Jupyter支持</text>
  
  <rect x="300" y="440" width="200" height="150" rx="8" fill="white" stroke="#EF4444" stroke-width="2"/>
  <text x="310" y="460" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#DC2626">
    搜索与分析工具
  </text>
  <text x="310" y="480" font-family="Arial, sans-serif" font-size="10" fill="#64748B">
    • Glob - 文件模式匹配</text>
  <text x="310" y="495" font-family="Arial, sans-serif" font-size="10" fill="#64748B">
    • Grep - 内容搜索</text>
  <text x="310" y="510" font-family="Arial, sans-serif" font-size="10" fill="#64748B">
    • Task - 复杂任务代理</text>
  <text x="310" y="525" font-family="Arial, sans-serif" font-size="10" fill="#64748B">
    • WebFetch - 网页获取</text>
  <text x="310" y="540" font-family="Arial, sans-serif" font-size="10" fill="#64748B">
    • WebSearch - 搜索引擎</text>
  <text x="310" y="555" font-family="Arial, sans-serif" font-size="10" fill="#64748B">
    • MCP - 外部工具集成</text>
  
  <rect x="520" y="440" width="200" height="150" rx="8" fill="white" stroke="#EF4444" stroke-width="2"/>
  <text x="530" y="460" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#DC2626">
    执行与管理工具
  </text>
  <text x="530" y="480" font-family="Arial, sans-serif" font-size="10" fill="#64748B">
    • Bash - 命令执行</text>
  <text x="530" y="495" font-family="Arial, sans-serif" font-size="10" fill="#64748B">
    • TodoRead - 任务读取</text>
  <text x="530" y="510" font-family="Arial, sans-serif" font-size="10" fill="#64748B">
    • TodoWrite - 任务管理</text>
  <text x="530" y="525" font-family="Arial, sans-serif" font-size="10" fill="#64748B">
    • exit_plan_mode - 模式切换</text>
  <text x="530" y="540" font-family="Arial, sans-serif" font-size="10" fill="#64748B">
    • Git操作 - 版本控制</text>
  <text x="530" y="555" font-family="Arial, sans-serif" font-size="10" fill="#64748B">
    • 构建工具集成</text>
  
  <rect x="740" y="440" width="200" height="150" rx="8" fill="white" stroke="#EF4444" stroke-width="2"/>
  <text x="750" y="460" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#DC2626">
    工具协作特性
  </text>
  <text x="750" y="480" font-family="Arial, sans-serif" font-size="10" fill="#64748B">
    • 并行工具调用</text>
  <text x="750" y="495" font-family="Arial, sans-serif" font-size="10" fill="#64748B">
    • 工具链组合</text>
  <text x="750" y="510" font-family="Arial, sans-serif" font-size="10" fill="#64748B">
    • 状态共享</text>
  <text x="750" y="525" font-family="Arial, sans-serif" font-size="10" fill="#64748B">
    • 错误恢复</text>
  <text x="750" y="540" font-family="Arial, sans-serif" font-size="10" fill="#64748B">
    • 上下文缓存</text>
  <text x="750" y="555" font-family="Arial, sans-serif" font-size="10" fill="#64748B">
    • 智能重试</text>
  
  <!-- 箭头3 -->
  <path d="M 500 600 L 500 630" stroke="#64748B" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- 输出层 -->
  <rect x="50" y="650" width="900" height="80" rx="10" fill="url(#outputGradient)" opacity="0.1"/>
  <text x="70" y="675" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#7C3AED">
    输出层 (Output Layer)
  </text>
  <text x="70" y="695" font-family="Arial, sans-serif" font-size="14" fill="#64748B">
    生成的测试文件: TransferUtilsTest.java
  </text>
  <text x="70" y="715" font-family="Arial, sans-serif" font-size="14" fill="#64748B">
    执行结果、状态反馈、错误信息、文档更新
  </text>
  
  <!-- 侧边流程说明 -->
  <rect x="960" y="200" width="35" height="400" rx="5" fill="#F1F5F9" stroke="#CBD5E1"/>
  <text x="977" y="220" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#64748B" transform="rotate(90 977 220)">
    执行流程
  </text>
  
  <!-- 流程步骤 -->
  <circle cx="977" cy="280" r="8" fill="#4F46E5"/>
  <text x="990" y="285" font-family="Arial, sans-serif" font-size="8" fill="#64748B">1</text>
  
  <circle cx="977" cy="350" r="8" fill="#059669"/>
  <text x="990" y="355" font-family="Arial, sans-serif" font-size="8" fill="#64748B">2</text>
  
  <circle cx="977" cy="420" r="8" fill="#DC2626"/>
  <text x="990" y="425" font-family="Arial, sans-serif" font-size="8" fill="#64748B">3</text>
  
  <circle cx="977" cy="490" r="8" fill="#DC2626"/>
  <text x="990" y="495" font-family="Arial, sans-serif" font-size="8" fill="#64748B">4</text>
  
  <circle cx="977" cy="560" r="8" fill="#7C3AED"/>
  <text x="990" y="565" font-family="Arial, sans-serif" font-size="8" fill="#64748B">5</text>
  
  <!-- 添加箭头定义 -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#64748B"/>
    </marker>
  </defs>
  
  <!-- 反馈循环箭头 -->
  <path d="M 900 300 Q 950 300 950 500 Q 950 550 900 550" stroke="#64748B" stroke-width="1" stroke-dasharray="5,5" fill="none" marker-end="url(#arrowhead)"/>
  <text x="955" y="425" font-family="Arial, sans-serif" font-size="10" fill="#64748B">
    反馈循环
  </text>
  
</svg>